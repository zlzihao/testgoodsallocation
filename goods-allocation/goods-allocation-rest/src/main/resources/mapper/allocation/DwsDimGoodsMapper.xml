<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.nome.saas.allocation.repository.dao.allocation.DwsDimGoodsDOMapper" >

    <resultMap id="BaseResultMap" type="cn.nome.saas.allocation.repository.entity.allocation.DwsDimGoodsDO" >
        <result column="CompanyNo" property="companyNo"  />
        <result column="CompanyName" property="companyName"  />
        <result column="StyleCode" property="styleCode"  />
        <result column="MatId" property="matId"  />
        <result column="MatCode" property="matCode"  />
        <result column="MatName" property="matName"  />
        <result column="Brand" property="brand" />
        <result column="ColorCode" property="colorCode"  />
        <result column="ColorName" property="colorName"  />
        <result column="CategoryCode" property="categoryCode"  />
        <result column="CategoryName" property="categoryName"  />
        <result column="MidCategoryCode" property="midCategoryCode"  />
        <result column="MidCategoryName" property="midCategoryName"  />
        <result column="SmallCategoryCode" property="smallCategoryCode"  />
        <result column="SmallCategoryName" property="smallCategoryName"  />
        <result column="SubCategoryCode" property="subCategoryCode"  />
        <result column="SubCategoryName" property="subCategoryName"  />
        <result column="QuotePrice" property="quotePrice" />
        <result column="SeriesNo" property="seriesNo"  />
        <result column="SeriesName" property="seriesName"  />
        <result column="MatLevelCode" property="matLevelCode"  />
        <result column="MatLevelCodeName" property="matLevelCodeName"  />
        <result column="YearNo" property="yearNo"  />
        <result column="SeasonNO" property="seasonNo"  />
        <result column="SeasonName" property="seasonName"  />
        <result column="OrderAttribCode" property="orderAttribCode"  />
        <result column="OrderAttribName" property="orderAttribName"  />
        <result column="Designer" property="designer"  />
        <result column="ElementCode" property="elementCode"  />
        <result column="ElementName" property="elementName"  />
        <result column="ClothesLenCode" property="clothesLenCode"  />
        <result column="ClothesLenName" property="clothesLenName"  />
        <result column="SleeveLenCode" property="sleeveLenCode"  />
        <result column="SleeveLenName" property="sleeveLenName"  />
        <result column="SleeveTypeCode" property="sleeveTypeCode"  />
        <result column="SleeveTypeName" property="sleeveTypeName"  />
        <result column="ThicknessCode" property="thicknessCode"  />
        <result column="ThicknessName" property="thicknessName"  />
        <result column="CollarTypeCode" property="collarTypeCode"  />
        <result column="CollarTypeName" property="collarTypeName"  />
        <result column="ClothesVerCode" property="clothesVerCode"  />
        <result column="ClothesVerName" property="clothesVerName"  />
        <result column="MatprofileCode" property="matprofileCode"  />
        <result column="MatprofileName" property="matprofileName"  />
        <result column="DesignNo" property="designNo"  />
        <result column="OrderNo" property="orderNo"  />
        <result column="SexCode" property="sexCode"  />
        <result column="SexName" property="sexName"  />
        <result column="MatTypeID" property="matTypeId"  />
        <result column="MatTypeName" property="matTypeName"  />
        <result column="ProSaleDate" property="proSaleDate"  />
        <result column="PlanLifeCycleEndDay" property="planLifeCycleEndDay" />
        <result column="LifeCycleDays" property="lifeCycleDays"  />
        <result column="LoadTime" property="loadTime"  />
        <result column="FactFOB" property="factFOB" />
        <result column="MatProperty" property="matProperty"  />
        <result column="BarCode" property="barCode"  />
        <result column="NumberNo" property="numberNo"  />
    </resultMap>

    <select id="getMatCodeList" resultType="java.lang.String">
        select Matcode from dws_dim_goods where 1 = 1
        <if test="yearNo != null">
            and yearNo IN (
            <foreach collection="yearNo" item="item" index="index" separator=",">
                '${item}'
            </foreach>
            )
        </if>
        <if test="seasonName != null">
            and SeasonName IN (
            <foreach collection="seasonName" item="item" index="index" separator=",">
                '${item}'
            </foreach>
            )

        </if>
        <if test="type == 1">
            and CategoryCode in ('W','M')
        </if>
        <if test="type == 2 ">
            and Categorycode not in ('W','M')
        </if>
        <if test="categoryNameList != null">
            and SmallCategoryName IN (
            <foreach collection="categoryNameList" item="item" index="index" separator=",">
                '${item}'
            </foreach>
            )
        </if>

        <if test="matCodeList != null">
            <foreach collection="matCodeList" open="and MatCode in ("  close=")" separator="," item="matCode">
                #{matCode}
            </foreach>
        </if>

    </select>


    <select id="getList" resultMap="BaseResultMap">
        select * from dws_dim_goods where 1 = 1
        <if test="yearNo != null">
            and yearNo = #{yearNo}
        </if>
        <if test="seasonName != null">
            and SeasonName = #{seasonName}
        </if>
        <if test="type == 1">
            and CategoryCode in ('W','M')
        </if>
        <if test="categoryNameList != null">
            and SmallCategoryName IN (
            <foreach collection="categoryNameList" item="item" index="index" separator=",">
                '${item}'
            </foreach>
            )
        </if>
    </select>

    <select id="getSimpleList" resultMap="BaseResultMap">
        select MatCode,MatName from dws_dim_goods
    </select>


    <select id="getSeasonList" resultType="cn.nome.saas.allocation.model.allocation.Paramater">
        SELECT DISTINCT(SeasonNO) as 'key',SeasonName as 'value' from dws_dim_goods
    </select>
    <select id="getYearNoList" resultType="cn.nome.saas.allocation.model.allocation.Paramater">
        SELECT DISTINCT(YearNo) as 'key',YearNo as 'value' from dws_dim_goods
    </select>

    <select id="getSeasonNameList" resultType="java.lang.String">
        SELECT DISTINCT SeasonName  from dws_dim_goods
    </select>

    <select id="getMidCategory" resultType="cn.nome.saas.allocation.model.allocation.Category">
        SELECT DISTINCT(MidCategoryCode) as CategoryCode,MidCategoryName as CategoryName
        from dws_dim_goods
        where MatCode in(SELECT DISTINCT(MatCode) from ${tableName})
        <if test="type == 1">
            and CategoryCode in ('W','M')
        </if>
        <if test="type == 2">
            and CategoryCode not in ('W','M')
        </if>
    </select>
    <select id="getSmallCategory" resultType="cn.nome.saas.allocation.model.allocation.Category">
        SELECT DISTINCT(SmallCategoryCode) as CategoryCode,SmallCategoryName as CategoryName
        from dws_dim_goods
        where 1= 1
        <if test="midCategoryCode != null">
        and MidCategoryCode= #{midCategoryCode}
        </if>
        and MatCode in(SELECT DISTINCT(MatCode) from ${tableName})
        <if test="type == 1">
            and CategoryCode in ('W','M')
        </if>
        <if test="type == 2">
            and CategoryCode not in ('W','M')
        </if>
    </select>

    <select id="getMatCodeListBy" resultType="java.lang.String">
        select matcode from dws_dim_goods where 1 = 1
        <if test="year != 'ALL'">
            and yearno = #{year}
        </if>
        <if test="season != 'ALL'">
            and seasonno = #{season}
        </if>

    </select>

    <select id="getMatCodeLisyByCategoryCode" resultType="java.lang.String">
        select matcode from dws_dim_goods where 1 = 1
        <if test="categoryCode != null">
            and CategoryCode = #{categoryCode}
        </if>
        <if test="midCategoryCode != null">
            and MidCategoryCode = #{midCategoryCode}
        </if>
        <if test="smallCategoryCode != null">
            and SmallCategoryCode = #{smallCategoryCode}
        </if>
    </select>

    <insert id="insertBatchDataCenterData">
        INSERT INTO
                      dws_dim_goods(CompanyNo, CompanyName, StyleCode, MatId, MatCode,
                      MatName, Brand, ColorCode, ColorName, CategoryCode, CategoryName,
                      MidCategoryCode, MidCategoryName, SmallCategoryCode, SmallCategoryName,
                      SubCategoryCode, SubCategoryName, QuotePrice, SeriesNo, SeriesName, MatLevelCode,
                      MatLevelCodeName, YearNo, SeasonNO, SeasonName, OrderAttribCode, OrderAttribName,
                      Designer, ElementCode, ElementName, ClothesLenCode, ClothesLenName, SleeveLenCode,
                      SleeveLenName, SleeveTypeCode, SleeveTypeName, ThicknessCode, ThicknessName, CollarTypeCode,
                    CollarTypeName, ClothesVerCode, ClothesVerName, MatprofileCode, MatprofileName, DesignNo,
                    OrderNo, SexCode, SexName, MatTypeID, MatTypeName, ProSaleDate, PlanLifeCycleEndDay,
                    LifeCycleDays, LoadTime, FactFOB, MatProperty, BarCode, NumberNo)
        <foreach collection="list" item="item" open="VALUES" separator=",">
            (#{item.companyNo}, #{item.companyName}, #{item.styleCode},
            #{item.matId}, #{item.matCode}, #{item.matName},
            #{item.brand}, #{item.colorCode}, #{item.colorName},
            #{item.categoryCode}, #{item.categoryName}, #{item.midCategoryCode},
            #{item.midCategoryName}, #{item.smallCategoryCode}, #{item.smallCategoryName},
            #{item.subCategoryCode}, #{item.subCategoryName}, #{item.quotePrice},
            #{item.seriesNo}, #{item.seriesName}, #{item.matLevelCode},
            #{item.matLevelCodeName}, #{item.yearNo}, #{item.seasonNo},
            #{item.seasonName}, #{item.orderAttribCode}, #{item.orderAttribName},
            #{item.designer}, #{item.elementCode}, #{item.elementName},
            #{item.clothesLenCode}, #{item.clothesLenName}, #{item.sleeveLenCode},
            #{item.sleeveLenName}, #{item.sleeveTypeCode}, #{item.sleeveTypeName},
            #{item.thicknessCode}, #{item.thicknessName}, #{item.collarTypeCode},
            #{item.collarTypeName}, #{item.clothesVerCode}, #{item.clothesVerName},
            #{item.matprofileCode}, #{item.matprofileName}, #{item.designNo},
            #{item.orderNo}, #{item.sexCode}, #{item.sexName}, #{item.matTypeId},
            #{item.matTypeName}, #{item.proSaleDate}, #{item.planLifeCycleEndDay},
            #{item.lifeCycleDays}, #{item.loadTime}, #{item.factFOB},
            #{item.matProperty}, #{item.barCode}, #{item.numberNo})
        </foreach>
    </insert>

    <delete id="clearAll" >
		truncate dws_dim_goods
	</delete>

    <select id="queryAvgPriceForQd" resultType="cn.nome.saas.allocation.repository.entity.allocation.DwsDimGoodsExDO">
        select CategoryName,MidCategoryName,round(sum(QuotePrice)/count(1),2) as avgPrice  from dws_dim_goods   group by CategoryName,MidCategoryName
    </select>
</mapper>